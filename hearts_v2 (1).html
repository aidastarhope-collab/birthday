<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hearts Game</title>
<style>
*{box-sizing:border-box}body{margin:0;background:#0b1220;color:#eaf2f8;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
canvas{background:#32516d;border:2px solid #031628;margin:16px auto;display:block;max-width:90vw}
.hud{display:flex;gap:16px;justify-content:center;margin:8px 0 0;font-weight:600}
.touch-controls{display:none;margin:16px 0;gap:16px;justify-content:center}
.touch-btn{padding:12px 20px;font-size:18px;border:0;border-radius:10px;background:#2E2E2E;color:white;font-weight:700;cursor:pointer;user-select:none}
.touch-btn:hover{background:#181717}.touch-btn:active{transform:scale(0.95)}
@media (max-width: 768px) {.touch-controls{display:flex}}
</style></head><body>
<div class="hud"><div>score: <span id="sc">0</span></div><div>time: <span id="tm">30</span>s</div></div>

<div id="stage" style="position:relative;display:grid;place-items:center;">
<canvas id="game" width="400" height="400"></canvas>
<div id="banner" style="position:absolute;display:none;padding:10px 14px;border-radius:12px;background:rgba(0,0,0,0.65);color:#fff;font-weight:800;box-shadow:0 4px 18px rgba(0,0,0,.4)">Time's over!</div>
</div>

<div class="touch-controls">
  <button class="touch-btn" id="leftBtn">⬅️ left</button>
  <button class="touch-btn" id="rightBtn">➡️ right</button>
</div>
<script>
(() => {
  const store = { get coins(){ return parseInt(localStorage.getItem('ldg_coins')||'0',10) }, set coins(v){ localStorage.setItem('ldg_coins', String(v)) } };
  function addCoins(n){ store.coins = Math.max(0, store.coins + n) }

  const canvas = document.getElementById('game'); const ctx = canvas.getContext('2d');
  const leftBtn = document.getElementById('leftBtn'); const rightBtn = document.getElementById('rightBtn');
  const BASKET_W = 60, BASKET_H = 60;
  const player = { x: 180, y: 340, w: BASKET_W, h: BASKET_H, speed: 20 };

  const basketImg = new Image(); basketImg.src = "basket.png";
  const heartSources = ["blue-heart.png", "pink-heart.png"]; const heartImages = [];
  let loadedCount = 0, playableCount = 0;
  function tryStart(){ if (loadedCount === heartSources.length) startGame(); }
  heartSources.forEach(src => { const img = new Image(); img.onload = ()=>{ playableCount++; loadedCount++; tryStart(); };
    img.onerror = ()=>{ loadedCount++; tryStart(); }; img.src = src; heartImages.push(img); });

  let hearts = [], score = 0, timeLeft = 30, gameOver = false, heartCount = 0, maxHearts = 50;
  let spawner = null, timer = null;

  function startGame(){ timer = setInterval(()=>{ if(timeLeft>0){ timeLeft--; document.getElementById('tm').textContent = timeLeft; } else { endGame('Time\'s over!'); } }, 1000);
    spawner = setInterval(spawnHeart, 450); loop(); }

  function endGame(msg){ if(gameOver) return; gameOver = true; clearInterval(timer); clearInterval(spawner); addCoins(score); var b=document.getElementById('banner'); if(b){ b.textContent = msg || (score>=50?'max. hearts collected!':'Time\'s over!'); b.style.display='block'; } }

  function spawnHeart(){ if(gameOver) return; if(heartCount >= maxHearts) return;
    const available = heartImages.filter(i => i.complete && i.naturalWidth > 0);
    const useImg = available.length > 0 ? available[Math.floor(Math.random() * available.length)] : null;
    hearts.push({ x: Math.random()* (400 - 24), y: -24, vy: 1.6 + Math.random()*1.4, img: useImg });
    heartCount++; }

  function draw(){
    ctx.clearRect(0,0,400,400);
    if (basketImg.complete && basketImg.naturalWidth > 0) { ctx.drawImage(basketImg, player.x, player.y, player.w, player.h);
    } else { ctx.fillStyle = '#ffd966'; ctx.fillRect(player.x, player.y, player.w, player.h); }
    hearts.forEach(h => {
      if (h.img && h.img.complete && h.img.naturalWidth > 0) { ctx.drawImage(h.img, h.x, h.y, 24, 24);
      } else { ctx.fillStyle = '#ff7ab5'; ctx.beginPath(); const r = 6;
        ctx.arc(h.x+8, h.y+10, r, 0, Math.PI*2); ctx.arc(h.x+16, h.y+10, r, 0, Math.PI*2);
        ctx.moveTo(h.x+22, h.y+12); ctx.lineTo(h.x+12, h.y+24); ctx.lineTo(h.x+2, h.y+12); ctx.closePath(); ctx.fill(); }
    });
    ctx.fillStyle = '#111'; ctx.font = '14px Arial'; 
  }

  function update(){
    if(gameOver) return;
    hearts.forEach(h => h.y += h.vy);
    hearts = hearts.filter(h => {
      if(h.y > 424) return false;
      const cx = h.x + 12, cy = h.y + 12;
      const withinX = cx > player.x && cx < player.x + player.w;
      const withinY = cy > player.y && cy < player.y + player.h + 10;
      if(withinX && withinY){ score++; document.getElementById('sc').textContent = score; if(score>=50) endGame('max. hearts collected!'); return false; }
      return true;
    });
  }

  function loop(){ update(); draw(); requestAnimationFrame(loop); }
  function moveLeft(){ if(gameOver) return; player.x = Math.max(0, player.x - player.speed); }
  function moveRight(){ if(gameOver) return; player.x = Math.min(400 - player.w, player.x + player.speed); }

  window.addEventListener('keydown', e=>{ if(e.key==='ArrowLeft'){ e.preventDefault(); moveLeft(); } if(e.key==='ArrowRight'){ e.preventDefault(); moveRight(); } }, {passive:false});
  leftBtn.addEventListener('click', moveLeft); rightBtn.addEventListener('click', moveRight);
  leftBtn.addEventListener('touchstart', e=>{e.preventDefault(); moveLeft();},{passive:false});
  rightBtn.addEventListener('touchstart', e=>{e.preventDefault(); moveRight();},{passive:false});
})();
</script>
</body></html>
